<!DOCTYPE html> 
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
    
	{% load staticfiles %}
    <!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	
	<style type="text/css">
		html, body {
			height:100%;
			position:relative;
			margin:0;
		}
		.wrapper {
			height:100%;
			display:flex;
			flex-flow:column nowrap;
		}
		.topbar-detail {
			flex: 1 0 auto;
			height:300px;
			width:100%;
			position:relative;
			background-color: #cccccc;		
		}
		.topbar-detail-content {
			z-index:1;
			position:absolute;
			top:50px;
			display:flex;
			margin-top:-50px;
			height:100%;
			width:100%;
			flex-flow: column nowrap;
			justify-content:center;
			align-items:center;
		}
		.topbar-detail-category {
			padding: 5px 10px;
			background-color:rgba(128, 191, 255,0.5);
			border-radius:10px;
			color:white;
			text-decoration:none;
		}
		.topbar-detail-title {
			margin-top:5px;
			letter-spacing: 10px;
		}
		.topbar {
			flex: 1 0 auto;
			height:400px;
			max-height:400px;
			width:100%;
			position:relative;
			background-color: #cccccc;
		}
		.topbar-navbar {
			position:absolute;
			top:0;
			width:100%;
			background-color: rgba(153, 153, 153, 0.5);
			border:none;
			z-index:2;
		}
		.topbar-content {
			z-index:1;
			position:absolute;
			top:50px;
			display:flex;
			margin-top:-50px;
			height:100%;
			width:100%;
			flex-flow: column nowrap;
			justify-content:center;
			align-items:center;
		}
		.topbar-title {
			flex:0 1 auto;
			margin:10px 0;
			color:white;
			padding:10px 20px;
			border: 5px solid white;
			font-size: 48px;
			letter-spacing: 10px;
		}
		.topbar-text {
			flex:0 1 auto;
			color:white;
			font-size: 24px;
			letter-spacing: 5px
		}
		.main-content {
			flex:1 0 auto;
			display:flex;
			flex-flow:row nowrap;
			width:1200px;
			margin: 0 auto;
			--background-color:#e6e6e6; 
		}
		.mycolumn {
			flex: 1;
			padding:0 10px;
		}
		.main-column {
			flex: 3;
		}		
		.post {
			margin: 15px 5px;
			position:relative;
			width:100%;
			height:300px;
			text-align:right;
			--border:1px solid black;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
		}
		.post:hover,.post:focus {box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);}
		.post-image {
			width:100%;
			height:100%;
		}
		.post-content {
			position:absolute;
			top:0px;
			display:flex;
			flex-flow:column nowrap;
			background-color:rgba(230, 230, 230,0.5);
			top:150px;
			bottom:0px;
			padding:10px 15px;
			height:150px;
			width:100%;
			text-align:left;
			text-decoration:none;
			color:black;
		}
		.post-content:hover,.post-content:focus {
			text-decoration:none;
			color:black;		
		}
		.post-category {
			top:0;
			left:0;
			padding: 5px 10px;
			margin:10px 20px;;
			position:absolute;
			background-color:rgba(128, 191, 255,0.5);
			border-radius:10px;
			color:white;
			text-decoration:none;
		}
		.post-category a {
			color:white;
			text-decoration:none;
		}
		.postlist-rating {
			top:0;
			right:0;
			padding: 5px 10px;
			margin:10px 20px;;
			position:absolute;
			background-color:rgba(128, 191, 255,0.5);
			border-radius:10px;
			text-decoration:none;
			color:gray;
		}		
		.positive {
			color:green;
		}
		.negative {
			color:red;
		}
		.post-descr{
			flex:1;
			height:60%;
		}
		.postlist-footer {
			flex:1;
			display:flex;
			flex-flow:row nowrap;
			bottom:0;
			height:10%;
			align-items:center;
		}
		.postlist-author, .postlist-comments {
			flex:1;
			text-align:left;
		}
		.postlist-comments {text-align:right;}
		.post-title{
			flex:1;
			margin:5px 0;
			height:20%;
		}
		
		.post-detail {
			margin: 15px 5px;
			padding:10px;
			position:relative;
			width:100%;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
		}
		.post-tags{
			display:flex;
			flex-flow: row nowrap;
			padding: 5px 20px;
			justify-content: flex-end;
		}
		.post-tag{
			margin: 0 2px;
			padding:2px 5px;
			font: 12px black;
			background-color: #e0e0eb;
			border-radius: 5px;
		}
		
		.post-footer{
			margin: 10px -10px;
			--border-top:1px solid;
			--border-bottom:1px solid;
			border-color:#bfbfbf;
			padding:10px 20px;
			font-size:12px;
			display:flex;
			flex-flow: row nowrap;
			align-items:center;
			background-color:#e6e6e6;
		}
		.post-footer .post_author {
			flex: 1 1 auto;
			text-align:left;
			font-size:16px;
		}
		.post-footer .post_date {
			flex: 1 1 auto;
			text-align:right;
		}
		#current_rating {
			margin: 0 15px;
			text-align:center;
			
		}
		
		/*---------------------Post comments---------------------*/	
		.post-comment-form {
			display:flex;
			flex-flow:row nowrap;
			width:100%;
			margin: 10px 0;
		}
		.comment-input {
			flex: 1 1 auto;
			padding: 0 10px;
			
		}
		.post-comment-form .save {
			flex: 0 1 auto;
		}
		
		.post-comment {
			display:flex;
			flex-flow: row wrap;
			align-items:center;
		}
		.comment-author {
			flex: 0 1 auto;
			order:1;
			text-align:left;
			padding:0 20px;
			font: normal 12px/12px 'Arial', sans-serif;
		}
		.comment-body {
			flex: 1 0 auto;
			background-color:#e6e6e6;
			border-radius:5px;
			padding: 10px;
			margin-right:10px;
			order:2;
		}
		.comment-date {
			flex: 1 100%;
			order:3;
			text-align:right;
			font: normal 12px/12px 'Arial', sans-serif;
			padding:5px;
			margin-right:10px;
		}		
		
		.side-block {
			margin: 15px 5px;
			--border:1px solid black;
			padding:10px;
		}
		
		/*----------sidebar------------*/
		.search-btn {
			cursor:pointer;
		}
		.categories-list .list-group {
			margin-bottom:0;
		}
		.category-search-link {
			text-decoration:none;
			color:black;
		}
		.category-search-link:hover,.category-search-link:focus {
			text-decoration:none;
			color:black;
		}
		.category-search-link li:hover {
			background-color:#e6e6e6;
		}
		
		.footer{
			flex: 1 0 auto;
			height:40px;
			max-height:40px;
			background-color:black;
		}
		
		/*-------------auth--------------*/
		.auth-wrapper {
			position:fixed;
			height:100%;
			width:100%;
			z-index:9;
			justify-content:center;
			align-items:center;
			background-color:rgba(0, 0, 0,0.5);
			display:none;
			transition: display 0.3s;
		}
		.auth-modal {
			margin: auto;
			width:300px;
			background-color: #e6e6e6;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
			display:flex;
			flex-flow:column nowrap;
		}
		.auth-modal-switcher {
			background-color: #d9d9d9;
			flex: 1 1 100%;
			height:10%;
			min-height:40px;
			display:flex;
			flex-flow:row nowrap;
			--padding: 10px 0;
			align-items:center;
			justify-content:center;
		}
		.signin,.register {
			flex: 1 1 50%;
			padding: 10px 0;
			text-align:center;
		}
		.signin:hover,.register:hover {
			cursor:pointer;
		}
		.auth-modal-switcher .active {
		    -webkit-transition: all 0.25s ease;
			-moz-transition: all 0.25s ease;
			-o-transition: all 0.25s ease;
			transition: all 0.25s ease;
			background-color: #e6e6e6;
		}		
		.auth-modal-content {
			flex: 1 0 100%;
			padding: 10px 15px;
		}
		.registerform{
			display:none;
		}
		.auth-modal-content .input-group {
			margin: 10px 0;
		}
		.auth-modal-content .btn {
			width:100%;
		}		
		.successresponse {
			display:none;
			min-height:60px;
			align-items:center;
			justify-content:center;
			background-color:lightgreen;
		}
		
		@media (max-width:767px) {
			.main-content {
				width:100%;
				flex-direction:column;
			}
			.mycolumn {
				padding: 0;
			}
			.post {
				width:95%;
				margin: 15px auto;
			}
			
			.post-content {
				overflow:hidden;
			}
			
			.topbar-navbar{
				height:50px;
				background-color: rgb(153, 153, 153);
			}
			.navbar-collapse li a {
				background-color: rgb(153, 153, 153);
			}
			.topbar-navbar .container {
				margin:0;
				padding:0;
			}
			
			#navbar {
				margin:0;
				padding:0;
				border-top:none;
			}
			.navbar-header {
				height:50px;
				margin-right:0 !important; 
				margin-left:0 !important;
			}
			.navbar-links{
				margin:0;
				width:100%;
			}
			
			.post-comment-form {
				display:flex;
				flex-flow:row wrap;
				width:100%;
				margin: 10px 0;
			}
			.comment-input {
				flex: 1 1 100%;
				padding: 0 10px;
				
			}
			.post-comment-form .save {
				flex: 0 1 100%;
				margin: 5px 10px;
			}
		}
		@media (min-width:767px) and (max-width:979px) {
			.main-content {
				width:100%;
			}		
		}
		@media (min-width:979px) and (max-width:1200px) {}
		@media (max-width:1200px) {		}
			
	</style>
	<title>Test</title>
	
</head>
<body>

	{% block auth %}
	<div class="auth-wrapper">
		<div class="auth-modal">
			<div class="auth-modal-switcher">
				<div class="signin active">
					Login
				</div>
				<div class="register">
					Register
				</div>
			</div>
			<div class="auth-modal-content loginform">
				<form id="login-form" method="POST" action="{% url 'list' %}">
					{% csrf_token %}
					<div class="input-group">
						<span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
						<input class="form-control" maxlength="30" name="username" type="text" placeholder="Login" /> 
					</div>
					<div class="input-group">
						<span class="input-group-addon"><span class="glyphicon glyphicon-pencil"></span></span>
						<input class="form-control" maxlength="30" name="password" type="password" placeholder="Password"/>
					</div>
					<button class="btn btn-success login-btn">Готово!</button>
				</form>			
			</div>
			<div class="auth-modal-content registerform">
				<form id="registration-form" method="post" autocomplete="off">
					{% csrf_token %}
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-user"></span></span>
						<input class="form-control" type="text" name="username" value="" size="50" placeholder="Username"  required />
					</div>
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-pencil"></span></span>
						<input class="form-control" type="password" name="password" value="" size="50" placeholder="password" required/>
					</div>
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">@</span>
						<input  class="form-control" type="email" name="email" value="" size="50" placeholder="Email" required/>
					</div>			
					<button class="btn btn-success">Готово!</button>
				</form>			
			</div>			
			<div class="auth-modal-content successresponse">
				<span class="ok-response">Ok!</span>
			</div>
		</div>
	</div>		
	{% endblock %}


	<div class="wrapper">
		<div class="topbar">
			{% block header %}
			<div class="topbar-navbar navbar">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
							<span class="glyphicon glyphicon-menu-hamburger"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="{% url 'list' %}">MyBlog</a>
					</div>
					<div id="navbar" class="navbar-collapse collapse">
						<ul class="nav navbar-nav navbar-right navbar-links">
							<li><a href="{% url 'list' %}">Blog</a></li>
							<li><a href="{% url 'image_index' %}">Gallery</a></li>
							<li><a href="#">Team</a></li>
							<li><a href="#">About</a></li>
							{% if not user.is_authenticated %}
								<li><a href="#" class="login-link">Login</a></li>
							{% else %}
								<li><a href="{% url 'logout' %}">Выйти</a></li>
							{% endif %}							
						</ul>			
					</div>
				</div>
			</div>
			{% endblock %}
			
			{% block title %}
			<div class="topbar-content">
				<h1 class="topbar-title">Title</h1>
				<p class="topbar-text">Text under title</p>
			</div>
			{% endblock %}
		</div>
		<div class="main-content">
			<section class="mycolumn main-column">
			{% block postlist %}

			{% endblock %}
			
			{% block postlist-paginator %}
			
			{% endblock %}
			</section>
			<aside class="mycolumn">
				{% block post-sider %}
				<div class="side-block categories">
					<form method="GET" action="{% url 'search_by_text' %}">
						<div class="input-group search-form">
							<input type="text" class="form-control" name="text" placeholder="Search..." aria-describedby="basic-addon2">
							<span class="input-group-addon search-btn" id="basic-addon2"><span class="glyphicon glyphicon-search" type="submit"></span></span>
						</div>
					</form>					
					<div class="categories-list">
						<h3>Категории:</h3>
						<ul class="list-group">
							{% for cat in categories %}
							<a href="/blog/categories/{{ cat.title }}" class="category-search-link">
								<li class="list-group-item">
									<span class="badge">{{ cat.get_count_of_posts_in }}</span>
									{{ cat.title }}
								</li>
							</a>
							{% endfor %}
						</ul>
					</div>
				</div>
				
				<!--
				<div class="side-block tags-cloud">
				
				</div>
				-->
				{% endblock %}
			</aside>
		</div>
		
		<div class="footer">
		
		</div>
	</div>
	
		
	
	{% block differentlinks %}
	
	{% endblock %}

	
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			//Кнопка быстрого перехода в начало страницы
			$(window).scroll(function(){
				if ($(window).scrollTop() > 0) { 
					$('.btntop').fadeIn();
				} else {
					$('.btntop').fadeOut();
				}
			});

			$('.btntop').click(function(){
				$('html, body').animate({scrollTop : 0},800);
				return false;
			});
			//Анимация наведения на пост
			$(".post").hover(function(){
				$(this).find(".post-content").animate({top:'100px',height:'200px'});
			},function(){
				$(this).find(".post-content").animate({top:'150px',height:'150px'});
			});
			//Модаль форм логина/регистрации			
			$('.signin').click(function(){
				$('.registerform').hide();
				$('.loginform').fadeIn();
				$(this).addClass('active');
				$('.register').removeClass('active');
			});
			$('.register').click(function(){
				$('.loginform').hide();
				$('.registerform').fadeIn();
				$(this).addClass('active');
				$('.signin').removeClass('active');
			});
//			
			$('.login-link').click(function(){
				$('.auth-wrapper').css('display','flex').hide().fadeIn(200);
			});
			$('.auth-wrapper').click(function(event){
				if(!$(event.target).closest('.auth-modal').length) {
					$('.auth-wrapper').fadeOut();
				}        
			});
//
			$('#login-form').submit(function(e){ //перехватить обработку формы
				e.preventDefault(); //Остановить обработку формы и заменить своим обработчиком
				$.ajax({
					type: $(this).attr('method'),
					url: $(this).action,
					context: {csrfmiddlewaretoken: '{{ csrf_token }}'},
					data: $(this).serialize(), // преобразовать набор передаваемых параметров в строку
					success: function(response){
						$('.loginform').hide();
						$('.auth-modal-switcher').hide();
						$('.successresponse').css('display','flex').hide().fadeIn(200);
						setTimeout(function(){window.location.href = ('{% url 'list' %}')}, 200);
							}
				});
			});
			
			$('#registration-form').submit(function(e){ //перехватить обработку формы
				e.preventDefault(); //Остановить обработку формы и заменить своим обработчиком
				alert('ok');
			});
		});
	</script>		
	
</body>
</html>
 